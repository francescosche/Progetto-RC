<!DOCTYPE html>
<html>
    <head>
        <title>Dettagli libro - Book time</title>
        <meta charset="utf-8" />
        <link href="style.css" type="text/css" rel="stylesheet" />
        <script type="text/javascript" src="js/jquery.js"></script>
        <script type="text/javascript" src="js/script.js"></script>
        <script>
            $(document).ready(function () {

                // CARICAMENTO FACEBOOK

                window.fbAsyncInit = function () {
                    FB.init({
                        appId: '194992524408368',
                        status: true,
                        cookie: true,
                        xfbml: true,
                        version    : 'v2.11'
                    });
                    FB.getLoginStatus(function(response) {
                        facebook_loaded = true;
                        console.log("API Facebook caricata");
                    });
                };
                (function(d, s, id) {
                    var js, fjs = d.getElementsByTagName(s)[0];
                    if (d.getElementById(id)) return;
                    js = d.createElement(s); js.id = id;
                    js.src = 'https://connect.facebook.net/it_IT/sdk.js#xfbml=1&version=v2.12';
                    fjs.parentNode.insertBefore(js, fjs);
                }(document, 'script', 'facebook-jssdk'));

                // INTERVALLO CHE CARICA LA PAGINA SOLO QUANDO SONO STATI CARICATI SIA GOOGLE CHE FACEBOOK

                var page_loaded = false;
                setInterval(function() {
                    if(facebook_loaded) {
                        if(!page_loaded) {
                            console.log("Carico la pagina");
                            pageLoad();
                            page_loaded = true;
                        }
                        console.log("Controllo gli accessi");
                        checkLogin();
                    }
                }, 250);

                if(getUrlParameter('access_token') != "") {
                    localStorage.GoogleAccessToken = getUrlParameter('access_token');
                }

                // Ottenere l'ID del libro da visualizzare dall'URL della pagina
                id_libro = window.location.search.substr(4, window.location.search.length);
                // Ricavare il titolo, l'URL dell'immagine di copertina, l'autore, il numero di pagine, la lingua, il voto e la trama del libro
                $.get("https://www.googleapis.com/books/v1/volumes/"+id_libro+"?key=AIzaSyBFzl0QHgg6tPybSNW0DMxAQF40oQFFKqA", function (response) {
                    titolo = response.volumeInfo.title;
                    var autore = "";
                    if(response.volumeInfo.hasOwnProperty('authors'))
                        response.volumeInfo.authors.forEach(function(name) {
                            autore += autore == "" ? name : ", "+name;
                        });
                    pagine = response.volumeInfo.pageCount;
                    lingua = response.volumeInfo.language;
                    trama = response.volumeInfo.description;
                    copertina = response.volumeInfo.imageLinks.medium;
                    $('.copertina').css("background-image", "url("+copertina+")");
                    $('.info > h1').text(titolo);
                    $('.info > h2').text(autore);
                    $('.info > .pagine').text(pagine);
                    $('.info > .lingua').text(lingua);
                    $('.info > span').last().html(trama);
                });





                // Se il libro è già presente nella libreria dell'utente, eliminare il tasto "Aggiungi alla mia libreria"

                // Completare funzione addToLibrary in /js/script.js che inserisce il libro attuale nella libreria "da leggere" dell'utente attuale





            });
        </script>
    </head>
    <body>
        <header>
            <div class="container">
                <form action="search.html" method="get">
                    <input type="text" name="q" placeholder="Cerca.." autocomplete="off"/>
                    <input type="submit" value="Cerca" hidden />
                </form>
            </div>
        </header>
        <div class="container">
            <nav>
                <a href="profile.html" class="current"><img src="img/user.svg" /><span></span></a>
                <a href="reading.html">In lettura</a>
                <a href="to-read.html">Da leggere</a>
                <a href="read.html">Letti</a>
                <a href="logout.html">Logout</a>
            </nav>
            <div class="book">
                <div class="left">
                    <div class="copertina"></div>
                    <div class="pages">
                        <a href="javascript:addToLibrary('ID_DEL_LIBRO');" class="button green">Aggiungi alla mia libreria</a>
                    </div>
                </div>
                <div class="info">
                    <h1></h1>
                    <h2></h2>
                    <span class="pagine"></span><br />
                    <span class="lingua"></span><br />
                    <span></span>
                </div>
            </div>
        </div>
    </body>
</html>
